FROM php:8.2-apache

# Copy Apache configurations
COPY my-httpd.conf /etc/apache2/sites-available/000-default.conf
COPY ssl-site.conf /etc/apache2/sites-available/default-ssl.conf
COPY security.ini /usr/local/etc/php/conf.d/security.ini

# Enable Apache modules for security and SSL
RUN a2enmod rewrite headers ssl

# Enable SSL site
RUN a2ensite default-ssl

# Install PHP extensions and tools in one layer for better caching
RUN apt-get update && apt-get install -y \
    curl \
    zip \
    unzip \
    && docker-php-ext-install pdo pdo_mysql mysqli \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean

# Enable OPcache for better PHP performance
RUN docker-php-ext-install opcache

# Copy optimized PHP configuration
COPY php-optimization.ini /usr/local/etc/php/conf.d/optimization.ini

# Set proper permissions and ownership
RUN chown -R www-data:www-data /var/www/html \
    && chmod -R 755 /var/www/html
